(function(){function r(){var e=JSON.parse(localStorage.getItem("SoundbotSave"));if(e)n=e;else if(typeof e===undefined)x()}function i(){API.on(API.CHAT,h);API.on(API.CHAT,b);API.on(API.USER_JOIN,l);API.on(API.USER_LEAVE,c);API.on(API.DJ_ADVANCE,g);API.setVolume(0);r();v();var e=setInterval(x,3e5);e();if(n.woot)$("#woot").click();API.sendChat("/em now sprinting!")}function s(){API.off(API.CHAT,h);API.off(API.CHAT,b);API.off(API.CHAT,l);API.off(API.USER_LEAVE,c);API.setVolume(15);saveSettnigs();clearInterval(zux);clearInterval(E);if(n.motd.enabled)clearInterval(motdInt);delete o;delete n;API.sendChat("Soundbot Shutdown.")}function l(e){o[e.id]={username:e.username,afktime:Date.now(),warning:false,removed:false,muted:false,roulSelect:false,roulChat:false}}function c(e){delete o[e.id]}function h(e){o[e.fromID].afkTime=Date.now();o[e.fromID].warning=false;o[e.fromID].roulChat=false}function p(){if(n.antiAfk.enabled){var t=API.getWaitList();var r=Date.now();for(var i in t){var s=o[t[i].id].afktime;var u=r-s;var f=Math.floor((r-s)/5e4)%60;if(u>n.antiAfk.limit&&!o[a[i].id].warning){API.sendChat("@"+t[i].username+" AFK Time: "+f+" minutes. Chat soon or I will remove you.");o[a[i].id].warning=true;setTimeout(function(){t=API.getWaitList();for(var n in t){if(o[t[e].id].warning){API.sendChat("@"+t[e].username+" last warning (AFK).");o[t[e].id].removed=true;setTimeout(function(){t=API.getWaitList();for(var e in t){if(t[e].warning&&t[e].removed){API.moderateRemoveDJ(t[e].id);o[t[e].id].warning=false;o[t[e].id].removed=false;o[t[e].id].afktime=Date.now()}else if(!t[e].warning&&t[e].removed){API.sendChat("/em Uh oh! There's been an error in the UserData. "+t[e].username+" has removed set to true, but not warning!")}}},12e4)}}},12e4)}}}}function d(){if(n.motd.enabled){var e=setInterval(function(){API.sendChat("/em "+[Math.floor(Math.random()*t.length)])},n.motd.interval)}}function v(){var e=API.getMedia().title;for(var t=0;t<v.length;t++){if(v[t]===e){API.sendChat("@"+API.getDJ().username+" that song is blacklisted!");var n=new Array;n.push(API.getDJ().id);if($(".cycle-toggle").hasClass("disabled")){$(this).click()}API.moderateLockWaitList(true,false);API.moderateForceSkip();for(var r=0;r<n.length;r++){setTimeout(function(){API.moderateMoveDJ(n[r],4)},500)}}}}function m(){API.on(API.HISTORY_UPDATE,function(e){var t=API.getMedia().title;for(var n=0;n<e.length;++n){if(e[n]===t){API.sendChat("@"+API.getDJ().username+" that song is in history!");var r=new Array;r.push(API.getDJ().id);if($(".cycle-toggle").hasClass("disabled")){$(this).click()}API.moderateLockWaitList(true,false);API.moderateForceSkip();API.moderateMoveDJ(t[1],5)}}})}function g(){if(n.woot)$("#woot").click();v();m()}function y(e,t){API.on(API.CHAT,function(n){e=e.trim();t=t.trim();for(var r=0;r<u.length;r++){if(u[r].id===e){if(t===false){if(n.fromID===e||n.fromID===u[r].id&&t===false){return true}else{if(n.fromID===e||n.fromID===u[r].id&&t===false){return false}}}if(t===true){if(n.fromID===e||n.fromID===u[r].id){return true}else{if(n.fromID!==e||n.fromID!==u[r].id&&t===true){return false}}if(n.fromID===e||e.fromID===u[r].id&&t===true){return n.message}}}}if(n.message==="!pass"&&o[n.fromID].roulSelect&&o[n.fromID].roulChat)API.moderateDeleteChat(n.chatID)})}function b(e){function t(){if(e.message.substr(1)==="!"){return"All Set"}}if(t){var r=e.message.substr(1).trim();var i=r.split("@")+1;var a=r.lastIndexOf(" ")+1;var f=r.split(" ")+1;var l=e.from;var c=e.fromID;var h=e.chatID;var p=function(){if(API.getUser(e.fromID).permission>=2){return true}else{return false}};if(e.message.substr(1)==="!")API.moderateDeleteChat(h);var d=new Array;var v=new Array;var m=new Array;switch(r){case"help":API.sendChat("/em ["+l+"] Soundbot was just recoded, so please wait for commands. Ask staff for questions.");break;case"web":API.sendChat("/em ["+l+"] FourBit website: NaN");break;case"ping":API.sendChat("/em ["+l+"] Pong!");break;case"link":if(API.getMedia().format===1){API.sendChat("/em ["+l+"] Link to current song: http://youtu.be/"+API.getMedia().cid)}else{var g=API.getMedia().cid;SC.get("/tracks",{ids:id},function(e){API.sendChat("/em ["+l+"] Link to current song: "+e[0].permalink_url)})}break;case"ad":API.sendChat("/em ["+l+"] ADBlock (the version that isn't bad): https://www.getadblock.com");break;case"pic":function b(e,t){if(e===null){return""}t=t===null?"big":t;var n;var r;r=e.match("[\\?&]v=([^&#]*)");n=r===null?e:r[1];if(t=="small"){return"http://img.youtube.com/vi/"+n+"/2.jpg"}else{return"http://img.youtube.com/vi/"+n+"/0.jpg"}}var w=API.getMedia();if(w.format==1){API.sendChat("/em ["+l+"][!pic] "+b(w.cid))}else{var E=SC.get("/tracks/"+w.cid,function(e){return e.permalink_url});var S=SC.get(E,function(e){var t=e.artwork;return t});if(!S){API.sendChat("Um, I kinda couldn't get the Soundcloud album link...")}else{API.sendChat("/em ["+l+"][!pic] "+S)}}break;case"roul":if(p()){if(f==="start"&&!n.roulette){API.sendChat("/em ["+l+'] Started roulette! Type "!join" to play.');n.roulette=true}if(f==="stop"&&n.roulette){clearInterval();n.roulette=false;o.roulSelect=false;o.roulChat=false;API.sendChat("/em ["+l+"] Stopped roulette! :frowning:")}}break;case"join":for(var S=0;S<d.length;S++){if(d[S]!==l&&d.length<10){API.sendChat("/em ["+l+"] Joined roulette!");d.push(l)}else{API.sendChat("/em ["+l+"] It seems that you already joined!")}}break;case"start":if(p()&&n.roulette){API.sendChat("/em ["+l+"] Game started!");var x=Math.floor(Math.random()*d.length);var g=setInterval(function(){API.sendChat("@"+d[x]+" you have the gun! Type !pass to pass it!!!");v.push(x);if(v[1]===d[x]){for(var e=0;e<u.length;e++){if(v===u[e].username){if(o[u[e].id].roulSelect&&!o[u[e].id].roulChat){o[u[e].id].roulChat=true;if(y(u[e].id,false)===true&&y(u[e].id,true)==="!pass"){API.sendChat("/em ["+l+"] Passed the gun!");o[u[e].id].roulSelect=false;o[u[e].id].roulChat=false;v.pop(u[e].username);m.push(u[e].username);d.pop(u[e].username)}}}else{clearInterval(this);g()}}}else{clearInterval(this);g()}},2e3);g()}break;case"add":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+" used add]");API.moderateAddDJ(u[S].id)}else API.sendChat("/em ["+l+"] User not found.")}}break;case"remove":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+" used remove]");API.moderateRemoveDJ(u[S].id)}else API.sendChat("/em ["+l+"] User not found.")}}break;case"move":if(p()){for(var S in u){if(u[S].username===i){if(a!==null||undefined){API.sendChat("/em ["+l+" used move]");var g=API.getWaitList();var x=parseInt(a);for(var T=0;T<g.length;T++){if(g[T].username!==u[S].username){API.moderateAddDJ(u[T].id);API.moderateMoveDJ(u[T].id,x)}else{if(g[T].username===u[S].username){API.moderateMoveDJ(u[T].id,x)}}}}}else API.sendChat("/em ["+l+"] User not found.")}}break;case"skip":if(p()){API.moderateForceSkip()}break;case"lockskip":if(p()){if(f==="op"){API.sendChat("/em ["+l+" used lockskip]");var N=new Array;N.push(API.getDJ());if($(".cycle-toggle").hasClass("disabled"))$(this).click();API.moderateLockWaitList(true,false);API.moderateForceSkip();API.sendChat("@"+N[1].username+" please pick another song because that one is overplayed!");setTimeout(function(){API.moderateMoveDJ(N[1].id,5)},500)}if(f!=="op"||f===null||f===undefined){API.sendChat("/em ["+l+" used lockskip]");var N=new Array;N.push(API.getDJ().id);if($(".cycle-toggle").hasClass("disabled"))$(this).click();API.moderateLockWaitList(true,false);API.moderateForceSkip();setTimeout(function(){API.moderateMoveDJ(N[1],5)},500)}}break;case"ban":if(p()){for(var S in u){if(u[S].username===i){if(a!==null||undefined){var g=parseInt(a);if(g===1){API.sendChat("/em ["+l+" used ban]");API.moderateBanUser(u[S].username,1,API.BAN.HOUR)}if(g===2){API.sendChat("/em ["+l+" used ban]");API.moderateBanUser(u[S].username,1,API.BAN.DAY)}if(g===3){API.sendChat("/em ["+l+" used ban]");API.moderateBanUser(u[S].username,1,API.BAN.PERMA)}else if(g>=4)API.sendChat("/em ["+l+"] Valid inputs are 1, 2, 3.")}}else API.sendChat("/em ["+l+"] User not found.")}}break;case"party":if(API.getUser(c).permission===5){if(!n.party&&f===null||f===undefined||a===null||a===undefined||i===null||i===undefined){n.party=true;API.sendChat("/em ["+l+" started a party]");API.moderateLockWaitList(true,true);var g=API.getUsers();var x=new Array;for(var S=0;S<g.length;S++){if(g[S].permission===1){x.push(g[S].id)}}var C=setInterval(function(){if(x.length!==0){for(var e=0;e<x.length;e++){API.moderateAddDJ(x[e].id)}}else clearInterval(C)},6e3);API.moderateForceSkip();$.ajax({type:"POST",url:"http://plug.dj/_/gateway/moderate.update_name_1",contentType:"application/json",data:'{"service":"moderate.update_name_1","body":["Join the party! | FourBit"]}'});if($(".cycle-toggle").hasClass("disabled")){$(this).click()}}else{API.sendChat("/em ["+l+"] It seems that a party is already in progress!")}if(n.party&&f==="end"||n.party&&f==="stop"){API.sendChat("/em ["+l+" stopped the current party]");$.ajax({type:"POST",url:"http://plug.dj/_/gateway/moderate.update_name_1",contentType:"application/json",data:'{"service":"moderate.update_name_1","body":["FourBitProductions | plug.dj"]}'});API.moderateLockWaitList(false);if($(".cycle-toggle").hasClass("enabled")){$(this).click()}}}break;case"status":if(p()){var g=Date().getTime();var x=Math.floor(joinTime-g);API.sendChat("/em ["+l+"] Uptime: "+x+" ~ Party: "+n.party+" ~ Blacklist: "+n.blacklist)}break;case"woot":if(p()){$("#woot").click()}break;case"grab":if(p()){$(".icon-curate").click();$($(".curate").children(".menu").children().children()[0]).mousedown()}break;case"kill":if(p()){s()}break;case"vr":if(p()){var g=API.getRoomScore();var x=new Array;var k=Math.floor(u.length-1);var N=Math.floor(k/g.positive*100);var T=Math.floor(k/g.curates*100);var L=Math.floor(k/g.negative*100);API.sendChat("/em ["+l+"] Votes: "+N+"% wooted, "+T+"% grabbed, "+L+"% meh'd!")}break;case"clear":if(p()){var g=$("#chat-messages").children();for(var S=0;S<g.length;S++){for(var T=0;T<g[S].classList.length;T++){if(g[S].classList[T].indexOf("cid-")===0){API.moderateDeleteChat(g[S].classList[T].substr(4))}}}API.sendChat("/em ["+l+" used clear]")}break;case"lock":if(p()){API.sendChat("/em ["+l+" used lock]");API.moderateLockWaitList(true,false)}break;case"cycle":if(p()){API.sendChat("/em ["+l+" used cycle]")}break;case"mute":if(p()){for(var S in u){if(u[S].username===i){o[u[S].id].mute=true;API.sendChat("/em ["+l+" muted "+u[S].username+"]")}}}break;case"unmute":if(p()){if(o[c].mute===true){API.sendChat("/em ["+l+"] Tried unmuting themselves, but can't! Muahahahaha!!!")}else{for(var S in u){if(u[S].username===i){o[u[S].id].mute=false}}}}break;case"kick":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+" used kick]");API.moderateBanUser(u[S].id,1,API.BAN.HOUR);setTimeout(function(){API.moderateUnbanUser(u[S].id);API.sendChat("/em ["+l+"] Kicked user can login now.")},15e3)}}}break;case"reg":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+"] Removed "+u[S].username+" from the staff!");API.moderateSetRole(u[S].id,API.ROLE.NONE)}}}break;case"rdj":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+"] Set "+u[S].username+" as a Resident DJ!");API.moderateSetRole(u[S].id,API.ROLE.RESIDENTDJ)}}}break;case"bouncer":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+"] Set "+u[S].username+" as a bouncer!");API.moderateSetRole(u[S].id,API.ROLE.BOUNCER)}}}break;case"manager":if(p()){for(var S in u){if(u[S].username===i){API.sendChat("/em ["+l+"] Set "+u[S].username+" as a manager!");API.moderateSetRole(u[S].id,API.ROLE.MANAGER)}}}break}}}function w(){var e=$("#chat-messages").last().text();var t=["Ambassador1","Admin1","Admin2","Ambassador2"];for(var n=0;n<e.length;n++){for(var r in u){for(var i=0;i<t.length;i++){var s=u[r].permission;if(e[n].split(" ")[0]===u[r].username){if(u[r].permission>=3&&u[r].permission<=5){API.sendChat("@"+u[r].username+" pls don't do that m8, you are not manager.");var o=e[n].split(" ")[2];API.moderateSetRole(e[n].id,s)}else{if(e[n].split(" ")[0]!==null){if(u[r].username!==t[i]){API.sendChat("@"+u[r].username+" pls don't do that m8, you are not manager.");var o=e[n].split(" ")[2];API.moderateSetRole(e[n].id,s)}}}}}}}}function S(){function i(){var e=API.getUsers();for(var t in e){for(var n=0;n<r.length;n++){if(e[t].username==r[n])return"userHasChatted";else return}}}var e={};var t=API.getUsers();for(var n in t){e[t[n].id]={warn:false,executeChat:false}}var r=[];API.on(API.USER_JOIN,function(t){e[t.id]={warn:false,executeChat:false}});API.on(API.USER_LEAVE,function(t){delete e[t.id]});var r=[];API.on(API.CHAT,function(t){if(t.message.indexOf("!execute")!=-1){if(API.getUser(t.fromID).permission>=2){var n=API.getUsers();for(var s in n){if(n[s].username===t.message.substr(10)){API.sendChat("/em ["+t.from+"][!execute] @"+t.message.substr(10)+" you are being executed for commiting crimes against this community. Any last words?");r.push(n[s].id);e[n[s].id].warn=true;setInterval(function(){if(i()==="userHasChatted"){e[n[s].id].executeChat=true;API.sendChat(Math.floor(Math.random()*outro.length));API.moderateBanUser(n[s].id,1,1);clearInterval(this);r=[]}setTimeout(function(){if(e[n[s].id].executeChat===false){API.sendChat("Wow. "+n[s].username+" chickened out of the execution. GET BANNED ANYWAY!!!");API.moderateBanUser(n[s].id,1,1);clearInterval(this);clearTimeout(this);r=[]}else{API.sendChat("Huh. I missed the user chatting. They still get to be banned!!!");API.moderateBanUser(n[s].id,1,1);clearInterval(this);clearTimeout(this);r=[]}n=API.getUsers();for(var i in n){if(n[i].id!==r[1]){API.sendChat("Well then, "+t.message.substr(10)+" left. Goodbye then.");$.ajax({type:"POST",url:"http://plug.dj/_/gateway/moderate.ban_1",contentType:"application/json",data:'{"service":"moderate.ban_1","body":["'+r[1]+'"]}'})}}},6e4)},1e3)}}}}})}function x(){localStorage.setItem("SoundbotSave",JSON.stringify(n))}var t=["Welcome to the FourBit plug.dj room!"];var n={woot:true,motd:{enabled:true,interval:15e5},antiAfk:{enabled:true,limit:36e5},blacklist:true,stats:true,historySkip:true,party:false,roulette:false};var o={};var u=API.getUsers();for(var f in u){o[u[f].id]={username:u[f].username,afktime:Date.now(),warning:false,removed:false,muted:false,roulSelect:false,roulChat:false}}var E=setInterval(function(){w()},50);E();i()}).call(this);
